---
title: エージェントの実行
description: Configure and execute agent workflows with the Runner class
---

import { Aside, Code } from '@astrojs/starlight/components';
import helloWorldWithRunnerExample from '../../../../../../examples/docs/hello-world-with-runner.ts?raw';
import helloWorldExample from '../../../../../../examples/docs/hello-world.ts?raw';
import runningAgentsExceptionExample from '../../../../../../examples/docs/running-agents/exceptions1.ts?raw';
import chatLoopExample from '../../../../../../examples/docs/running-agents/chatLoop.ts?raw';

エージェント はそれ自体では何もしません — `Runner` クラスまたは `run()` ユーティリティでそれらを **実行** します。

<Code lang="typescript" code={helloWorldExample} title="シンプルな実行" />

カスタム Runner が不要な場合は、デフォルトのシングルトン `Runner` インスタンスを実行する `run()` ユーティリティも使えます。

または、独自の Runner インスタンスを作成できます:

<Code
  lang="typescript"
  code={helloWorldWithRunnerExample}
  title="シンプルな実行"
/>

エージェント を実行すると、実行の最終出力と完全な履歴を含む [エージェントの実行結果](/openai-agents-js/ja/guides/results) オブジェクトが返されます。

## エージェント ループ

Runner の run メソッドを使うときは、開始する エージェント と入力を渡します。入力は、文字列（ユーザー メッセージとして扱われます）、または 入力アイテム のリスト（OpenAI Responses API のアイテム）です。

その後 Runner はループを実行します:

1. 現在の入力で、現在の エージェント のモデルを呼び出す
2. LLM の応答を確認する
   - **最終出力** → return
   - **ハンドオフ** → 新しい エージェント に切り替え、蓄積された会話履歴を保持し、1 に戻る
   - **ツール呼び出し** → ツールを実行し、その結果を会話に追加し、1 に戻る
3. `maxTurns` に達したら [`MaxTurnsExceededError`](/openai-agents-js/openai/agents-core/classes/maxturnsexceedederror) を投げる

<Aside type="note">
  LLM の出力が「最終出力」と見なされる条件は、
  望ましい型のテキスト出力を生成し、ツール呼び出しが 1 つもないことです。
</Aside>

### Runner ライフサイクル

アプリの起動時に `Runner` を作成し、リクエスト間で再利用します。インスタンスはモデル プロバイダーや トレーシング オプションといったグローバル設定を保持します。まったく異なるセットアップが必要な場合にのみ、別の `Runner` を作成してください。簡単なスクリプトでは、内部でデフォルトの Runner を使う `run()` を呼び出すこともできます。

## 実行の引数

`run()` メソッドの入力は、実行を開始する初期 エージェント、実行の入力、およびオプションのセットです。

入力は、文字列（ユーザー メッセージとして扱われます）、[入力アイテム](/openai-agents-js/openai/agents-core/type-aliases/agentinputitem) のリスト、または [人間の介入（HITL）](/openai-agents-js/ja/guides/human-in-the-loop) エージェントを構築している場合は [`RunState`](/openai-agents-js/openai/agents-core/classes/runstate) オブジェクトのいずれかです。

追加のオプションは次のとおりです:

| オプション | 既定    | 説明                                                                                                                                                     |
| ---------- | ------- | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `stream`   | `false` | `true` の場合、呼び出しは `StreamedRunResult` を返し、モデルから到着したイベントを逐次配信します。                                                       |
| `context`  | –       | すべてのツール / ガードレール / ハンドオフに転送されるコンテキスト オブジェクト。詳しくは [コンテキスト管理](/openai-agents-js/ja/guides/context) を参照 |
| `maxTurns` | `10`    | セーフティ リミット — 到達すると [`MaxTurnsExceededError`](/openai-agents-js/openai/agents-core/classes/maxturnsexceedederror) を投げます                |
| `signal`   | –       | キャンセル用の `AbortSignal`                                                                                                                             |

## ストリーミング

ストリーミング により、LLM が実行される間にストリーミング イベントを受け取れます。ストリームが開始されると、`StreamedRunResult` には、その実行に関する完全な情報（新しく生成されたすべての出力を含む）が含まれます。`for await` ループでストリーミング イベントを反復処理できます。詳しくは [ストリーミング](/openai-agents-js/ja/guides/streaming) を参照してください。

## Run 設定

独自の `Runner` インスタンスを作成する場合は、`RunConfig` オブジェクトを渡して Runner を設定できます。

| フィールド                  | 型                    | 目的                                                                        |
| --------------------------- | --------------------- | --------------------------------------------------------------------------- |
| `model`                     | `string \| Model`     | 実行内の **すべて** の エージェント に特定のモデルを強制する                |
| `modelProvider`             | `ModelProvider`       | モデル名を解決します — 既定では OpenAI プロバイダー                         |
| `modelSettings`             | `ModelSettings`       | グローバルな調整パラメーターで、エージェントごとの設定を上書きします        |
| `handoffInputFilter`        | `HandoffInputFilter`  | ハンドオフを実行するときに入力アイテムを変換（ハンドオフ側で未定義の場合）  |
| `inputGuardrails`           | `InputGuardrail[]`    | 最初の ユーザー 入力に適用される ガードレール                               |
| `outputGuardrails`          | `OutputGuardrail[]`   | 最終出力 に適用される ガードレール                                          |
| `tracingDisabled`           | `boolean`             | OpenAI Tracing を完全に無効化                                               |
| `traceIncludeSensitiveData` | `boolean`             | トレースから LLM / ツールの入力と出力を除外しつつ、span は発行します        |
| `workflowName`              | `string`              | Traces ダッシュボードに表示され、関連する実行をグループ化するのに役立ちます |
| `traceId` / `groupId`       | `string`              | SDK に生成させる代わりに、トレース ID またはグループ ID を手動指定          |
| `traceMetadata`             | `Record<string, any>` | すべての span に付与する任意のメタデータ                                    |

## 会話 / チャット スレッド

それぞれの `runner.run()`（または `run()` ユーティリティ）呼び出しは、アプリケーション レベルの会話における 1 回の **ターン** を表します。エンド ユーザー にどれだけ `RunResult` を見せるかは自由です — ときには `finalOutput` のみ、ときには生成されたすべてのアイテムを表示します。

<Code lang="typescript" code={chatLoopExample} title="会話履歴を引き継ぐ例" />

対話的なバージョンは [チャットの code examples](https://github.com/openai/openai-agents-js/tree/main/examples/basic/chat.ts) を参照してください。

## 例外

SDK は捕捉可能な少数のエラーを投げます:

- [`MaxTurnsExceededError`](/openai-agents-js/openai/agents-core/classes/maxturnsexceedederror) – `maxTurns` に到達
- [`ModelBehaviorError`](/openai-agents-js/openai/agents-core/classes/modelbehaviorerror) – モデルが不正な出力を生成（例: 不正な JSON、未知のツール）
- [`InputGuardrailTripwireTriggered`](/openai-agents-js/openai/agents-core/classes/inputguardrailtripwiretriggered) / [`OutputGuardrailTripwireTriggered`](/openai-agents-js/openai/agents-core/classes/outputguardrailtripwiretriggered) – ガードレール 違反
- [`GuardrailExecutionError`](/openai-agents-js/openai/agents-core/classes/guardrailexecutionerror) – ガードレール が完了できなかった
- [`ToolCallError`](/openai-agents-js/openai/agents-core/classes/toolcallerror) – 関数ツール の呼び出しのいずれかが失敗
- [`UserError`](/openai-agents-js/openai/agents-core/classes/usererror) – 設定または ユーザー 入力に基づくエラー

これらはすべて基底の `AgentsError` クラスを拡張しており、現在の実行状態にアクセスするための `state` プロパティを提供することがあります。

以下は `GuardrailExecutionError` を処理するコード例です:

<Code
  lang="typescript"
  code={runningAgentsExceptionExample}
  title="ガードレール実行エラー"
/>

上記の例を実行すると、次の出力が表示されます:

```
Guardrail execution failed: Error: Input guardrail failed to complete: Error: Something is wrong!
Math homework guardrail tripped
```

---

## 次のステップ

- [モデル](/openai-agents-js/ja/guides/models) の構成方法を学ぶ
- エージェント に [ツール](/openai-agents-js/ja/guides/tools) を提供する
- 本番対応のために [ガードレール](/openai-agents-js/ja/guides/guardrails) や [トレーシング](/openai-agents-js/ja/guides/tracing) を追加する
