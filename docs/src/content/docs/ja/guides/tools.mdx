---
title: ツール
description: Provide your agents with capabilities via hosted tools or custom function tools
---

import { Code } from '@astrojs/starlight/components';
import toolsFunctionExample from '../../../../../../examples/docs/tools/functionTools.ts?raw';
import toolsHostedToolsExample from '../../../../../../examples/docs/tools/hostedTools.ts?raw';
import localBuiltInToolsExample from '../../../../../../examples/docs/tools/localBuiltInTools.ts?raw';
import nonStrictSchemaTools from '../../../../../../examples/docs/tools/nonStrictSchemaTools.ts?raw';
import agentsAsToolsExample from '../../../../../../examples/docs/tools/agentsAsTools.ts?raw';
import agentsAsToolsStreamingExample from '../../../../../../examples/docs/tools/agentsAsToolsStreaming.ts?raw';
import mcpLocalServer from '../../../../../../examples/docs/tools/mcpLocalServer.ts?raw';
import codexToolExample from '../../../../../../examples/docs/tools/codexTool.ts?raw';
import codexRunContextThreadExample from '../../../../../../examples/docs/tools/codexRunContextThread.ts?raw';

ツールはエージェントに**行動をとらせる**ためのものです。データ取得、外部 API 呼び出し、コード実行、さらにはコンピュータの使用まで可能にします。JavaScript/TypeScript SDK は次の 6 つのカテゴリーに対応しています:

1. **OpenAI がホストするツール** – モデルと同じ OpenAI のサーバー上で実行されます（Web 検索、ファイル検索、Code Interpreter、画像生成）
2. **ローカル組み込みツール** – あなたの環境で実行されます（コンピュータ操作、shell、apply_patch）
3. **関数ツール** – 任意のローカル関数を JSON スキーマでラップし、LLM が呼び出せるようにします
4. **Agents as tools** – エージェント全体を呼び出し可能なツールとして公開します
5. **MCP サーバー** – Model context protocol のサーバー（ローカルまたはリモート）を接続します
6. **実験的: Codex ツール** – Codex SDK を関数ツールとしてラップし、ワークスペース対応タスクを実行します

---

## 1. Hosted tools (OpenAI Responses API)

`OpenAIResponsesModel` を使用すると、以下の組み込みツールを追加できます:

| ツール                  | Type string          | 目的                                        |
| ----------------------- | -------------------- | ------------------------------------------- |
| Web search              | `'web_search'`       | インターネット検索                          |
| File / retrieval search | `'file_search'`      | OpenAI がホストするベクトルストアへのクエリ |
| Code Interpreter        | `'code_interpreter'` | サンドボックス環境でコードを実行            |
| Image generation        | `'image_generation'` | テキストに基づく画像生成                    |

<Code lang="typescript" code={toolsHostedToolsExample} title="Hosted tools" />

パラメーターの詳細は OpenAI Responses API と一致します。`rankingOptions` やセマンティックフィルタなどの高度なオプションは公式ドキュメントを参照してください。

---

## 2. Local built-in tools

ローカル組み込みツールはあなたの環境で実行され、実装の提供が必要です:

- **コンピュータ操作** – `Computer` インターフェースを実装して `computerTool()` に渡す
- **Shell** – `Shell` インターフェースを実装して `shellTool()` に渡す
- **Apply patch** – `Editor` インターフェースを実装して `applyPatchTool()` に渡す

これらのツールはローカルで実行され、OpenAI によってホストされるものではありません。ランタイムでファイル、ターミナル、GUI オートメーションに直接アクセスする必要がある場合に使用します。ツール呼び出しは OpenAI モデルのレスポンスによって要求されますが、実行はあなたのアプリケーションがローカルで行います。

<Code
  lang="typescript"
  code={localBuiltInToolsExample}
  title="Local built-in tools"
/>

---

## 3. Function tools

`tool()` ヘルパーを使うと、**任意**の関数をツール化できます。

<Code
  lang="typescript"
  code={toolsFunctionExample}
  title="Function tool with Zod parameters"
/>

### オプションリファレンス

| フィールド         | 必須   | 説明                                                                                                                                                                 |
| ------------------ | ------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `name`             | いいえ | 省略時は関数名（例: `get_weather`）                                                                                                                                  |
| `description`      | はい   | LLM に表示される明確で人間が読める説明                                                                                                                               |
| `parameters`       | はい   | Zod スキーマまたは元の JSON スキーマオブジェクトのいずれか。Zod のパラメーターは自動的に **strict** モードを有効化                                                   |
| `strict`           | いいえ | `true`（デフォルト）の場合、引数がバリデーションに失敗すると SDK はモデルエラーを返します。あいまいなマッチングには `false` を設定                                   |
| `execute`          | はい   | `(args, context) => string \| unknown \| Promise<...>` – ビジネスロジック。文字列以外の出力はモデル向けにシリアライズ。第 2 引数として任意で `RunContext` を受け取る |
| `errorFunction`    | いいえ | 内部エラーをユーザー向け文字列に変換するカスタムハンドラー `(context, error) => string`                                                                              |
| `needsApproval`    | いいえ | 実行前に人間の承認を要求します。詳しくは[人間の介入（HITL）](/openai-agents-js/ja/guides/human-in-the-loop) を参照                                                   |
| `isEnabled`        | いいえ | 実行ごとに条件付きでツールを公開。boolean または述語を受け付ける                                                                                                     |
| `inputGuardrails`  | いいえ | ツール実行前に走るガードレール。拒否や例外が可能。詳しくは[ガードレール](/openai-agents-js/ja/guides/guardrails#tool-guardrails) を参照                              |
| `outputGuardrails` | いいえ | ツール実行後に走るガードレール。拒否や例外が可能。詳しくは[ガードレール](/openai-agents-js/ja/guides/guardrails#tool-guardrails) を参照                              |

### 非 strict な JSON スキーマツール

無効または不完全な入力をモデルに推測させたい場合は、元の JSON スキーマ使用時に strict モードを無効化できます:

<Code
  lang="typescript"
  code={nonStrictSchemaTools}
  title="Non-strict JSON schema tools"
/>

---

## 4. Agents as tools

会話全体を完全にハンドオフせずに、あるエージェントが別のエージェントを支援させたい場合があります。その場合は `agent.asTool()` を使います:

<Code lang="typescript" code={agentsAsToolsExample} title="Agents as tools" />

内部的には SDK は次を行います:

- 単一の `input` パラメーターを持つ関数ツールを作成
- ツールが呼ばれたときにサブエージェントをその入力で実行
- 最後のメッセージまたは `customOutputExtractor` で抽出された出力を返却

エージェントをツールとして実行すると、Agents SDK はデフォルト設定でランナーを作成し、関数の実行内でそのランナーを使ってエージェントを実行します。`runConfig` や `runOptions` のプロパティを指定したい場合は、`asTool()` に渡してランナーの動作をカスタマイズできます。

また、`asTool()` のオプションでエージェントツールに `needsApproval` と `isEnabled` を設定し、Human in the loop（人間の介入）フローや条件付き公開に統合できます。

`agent.asTool()` の構造化入力に関する高度なオプション:

- `inputBuilder`: 構造化ツール引数をネストしたエージェント入力ペイロードにマッピング
- `includeInputSchema`: 強力なスキーマ認識のために、ネストした実行に入力 JSON スキーマを含める
- `resumeState`: ネストしたシリアライズ済み `RunState` を再開する際のコンテキスト再調整戦略を制御

### エージェントツールからのストリーミングイベント

エージェントツールはネストした実行のすべてのイベントをアプリにストリーミングできます。ツールの構築方法に合ったフックスタイルを選んでください:

<Code
  lang="typescript"
  code={agentsAsToolsStreamingExample}
  title="Streaming agent tools"
/>

- イベント種別は `RunStreamEvent['type']` に一致: `raw_model_stream_event`, `run_item_stream_event`, `agent_updated_stream_event`
- `onStream` は最もシンプルなキャッチオールで、ツールをインライン宣言する場合（`tools: [agent.asTool({ onStream })]`）に適しています。イベントごとのルーティングが不要な場合に使用
- `on(eventName, handler)` は選択的（または `'*'`）に購読でき、より細かな処理や作成後にリスナーを付与したい場合に最適
- `onStream` またはいずれかの `on(...)` ハンドラーを指定すると、自動的にエージェントツールはストリーミングモードで実行。指定しない場合は非ストリーミング経路のまま
- ハンドラーは並行に呼び出されるため、遅い `onStream` コールバックが `on(...)` ハンドラーをブロックすることはない（その逆も同様）
- `toolCallId` は、ツールがモデルのツールコール経由で呼ばれた場合に提供されます。直接の `invoke()` 呼び出しやプロバイダー特有の挙動では省略される場合あり

---

## 5. MCP servers

[Model Context Protocol (MCP)](https://modelcontextprotocol.io/) サーバーを通じてツールを公開し、エージェントに接続できます。たとえば `MCPServerStdio` を使って stdio MCP サーバーを起動・接続できます:

<Code lang="typescript" code={mcpLocalServer} title="Local MCP server" />

完全な例は [`filesystem-example.ts`](https://github.com/openai/openai-agents-js/tree/main/examples/mcp/filesystem-example.ts) を参照してください。また、MCP サーバーツール統合の包括的ガイドをお探しの場合は、[MCP 連携](/openai-agents-js/ja/guides/mcp) を参照してください。複数サーバーの管理（または部分的な障害）には、`connectMcpServers` と [MCP 連携](/openai-agents-js/ja/guides/mcp#managing-mcp-server-lifecycle) のライフサイクルガイダンスを使用してください。

---

## 6. Experimental: Codex tool

`@openai/agents-extensions/experimental/codex` は `codexTool()` を提供します。これはモデルのツールコールを Codex SDK にルーティングし、エージェントがワークスペーススコープのタスク（shell、ファイル編集、MCP ツール）を自律的に実行できる関数ツールです。このインターフェースは実験的で変更される場合があります。

まず依存関係をインストールします:

```bash
npm install @openai/agents-extensions @openai/codex-sdk
```

クイックスタート:

<Code
  lang="typescript"
  code={codexToolExample}
  title="Experimental Codex tool"
/>

知っておくべきこと:

- 認証: `CODEX_API_KEY`（推奨）または `OPENAI_API_KEY` を指定、もしくは `codexOptions.apiKey` を渡す
- 入力: 厳密なスキーマ — `inputs` は少なくとも `{ type: 'text', text }` または `{ type: 'local_image', path }` を 1 つ含む必要がある
- セーフティ: `sandboxMode` と `workingDirectory` を組み合わせて使用。ディレクトリが Git リポジトリでない場合は `skipGitRepoCheck` を設定
- スレッディング: `useRunContextThreadId: true` は `runContext.context` に最新の thread id を読み書きし、アプリ状態でのターン間再利用に有用
- Thread ID の優先順位: ツールコールの `threadId`（スキーマに含めている場合）が最優先、その次にランコンテキストの thread id、次に `codexTool({ threadId })`
- 実行コンテキストキー: デフォルトは `name: 'codex'` の場合 `codexThreadId`、`name: 'engineer'` のような名前では `codexThreadId_<suffix>`（正規化後は `codex_engineer`）
- 変更可能なコンテキスト要件: `useRunContextThreadId` を有効化する場合、`run(..., { context })` に変更可能なオブジェクトまたは `Map` を渡す
- 命名: ツール名は `codex` 名前空間に正規化され（`engineer` は `codex_engineer` になる）、同一エージェント内の Codex ツール名の重複は拒否
- ストリーミング: `onStream` は Codex のイベント（推論、コマンド実行、MCP ツール呼び出し、ファイル変更、Web 検索）を反映し、進行状況のログやトレースが可能
- 出力: ツール結果には `response`、`usage`、`threadId` が含まれ、Codex のトークン使用量は `RunContext` に記録
- 構造: `outputSchema` はディスクリプタ、JSON スキーマオブジェクト、または Zod オブジェクトを使用可能。JSON オブジェクトスキーマでは `additionalProperties` は `false` 必須

実行コンテキストのスレッド再利用の例:

<Code
  lang="typescript"
  code={codexRunContextThreadExample}
  title="Codex run-context thread reuse"
/>

---

## Tool use behavior

モデルがツールを使用するタイミングや方法の制御については、[エージェント](/openai-agents-js/ja/guides/agents#forcing-tool-use) を参照してください（`modelSettings.toolChoice`、`toolUseBehavior` など）。

---

## ベストプラクティス

- **短く明確な説明** – ツールが「何を」「いつ」行うかを記述
- **入力を検証** – 可能な限り Zod スキーマで厳密な JSON 検証を行う
- **エラーハンドラーで副作用を避ける** – `errorFunction` は有用な文字列を返し、例外を投げない
- **ツールは単一責務に** – 小さく合成しやすいツールはモデルの推論精度を高める

---

## 次のステップ

- [ツール使用の強制](/openai-agents-js/ja/guides/agents#forcing-tool-use) について学ぶ
- ツールの入力や出力を検証するために[ガードレール](/openai-agents-js/ja/guides/guardrails) を追加
- [`tool()`](/openai-agents-js/openai/agents/functions/tool) と各種ホスト型ツールタイプの TypeDoc リファレンスを参照
