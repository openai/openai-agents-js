---
title: エージェントの実行結果
description: Learn how to access the results and output from your agent run
---

import { Code } from '@astrojs/starlight/components';
import handoffFinalOutputTypes from '../../../../../../examples/docs/results/handoffFinalOutputTypes.ts?raw';
import historyLoop from '../../../../../../examples/docs/results/historyLoop.ts?raw';

[エージェントの実行](/openai-agents-js/ja/guides/running-agents) を行うと、次のいずれかを受け取ります:

- [`RunResult`](/openai-agents-js/openai/agents/classes/runresult) — `stream: true` なしで `run` を呼び出した場合
- [`StreamedRunResult`](/openai-agents-js/openai/agents/classes/streamedrunresult) — `stream: true` を指定して `run` を呼び出した場合。ストリーミングの詳細は [ストリーミング](/openai-agents-js/ja/guides/streaming) も参照してください

## 最終出力

`finalOutput` プロパティには、最後に実行されたエージェントの最終出力が含まれます。この結果は次のいずれかです:

- `string` — `outputType` が定義されていないエージェントのデフォルト
- `unknown` — エージェントが出力タイプとして JSON スキーマを定義している場合。この場合、JSON はパースされていますが、型を手動で検証する必要があります
- `z.infer<outputType>` — エージェントが出力タイプとして Zod スキーマを定義している場合。出力は自動的にこのスキーマに対してパースされます
- `undefined` — エージェントが出力を生成しなかった場合（たとえば出力を生成する前に停止した場合）

異なる出力タイプを持つハンドオフを使用する場合は、エージェントを作成する際に `new Agent()` コンストラクターではなく `Agent.create()` メソッドを使用してください

これにより SDK がすべての可能なハンドオフにわたって出力タイプを推論でき、`finalOutput` プロパティに対してユニオン型を提供します

例:

<Code
  lang="typescript"
  code={handoffFinalOutputTypes}
  title="ハンドオフの最終出力の型"
/>

## 次のターンの入力

次のターンの入力にアクセスする方法は 2 つあります:

- `result.history` — 入力とエージェントの出力の両方のコピーを含みます
- `result.output` — エージェント実行全体の出力を含みます

`history` は、チャットのようなユースケースで完全な履歴を保持する便利な方法です:

<Code lang="typescript" code={historyLoop} title="履歴ループ" />

## 最後のエージェント

`lastAgent` プロパティには最後に実行されたエージェントが含まれます。アプリケーションによっては、次回 ユーザー が入力する際に役立つことがよくあります。たとえば、フロントラインのトリアージ エージェントが言語別エージェントにハンドオフする構成であれば、最後のエージェントを保存しておき、次回 ユーザー がエージェントにメッセージを送るときに再利用できます

ストリーミング モードでは、現在実行中のエージェントに対応する `currentAgent` プロパティへアクセスできると便利な場合もあります

## 新規アイテム

`newItems` プロパティには、実行中に生成された新しいアイテムが含まれます。アイテムは [`RunItem`](/openai-agents-js/openai/agents/type-aliases/runitem) です。Run item は、 LLM が生成した元のアイテムをラップします。これらを使うと、 LLM の出力に加えて、各イベントがどのエージェントに関連付けられていたかにもアクセスできます

- [`RunMessageOutputItem`](/openai-agents-js/openai/agents/classes/runmessageoutputitem) は LLM からのメッセージを表します。元のアイテムは生成されたメッセージです
- [`RunHandoffCallItem`](/openai-agents-js/openai/agents/classes/runhandoffcallitem) は LLM がハンドオフ ツールを呼び出したことを表します。元のアイテムは LLM からのツール呼び出しアイテムです
- [`RunHandoffOutputItem`](/openai-agents-js/openai/agents/classes/runhandoffoutputitem) はハンドオフが発生したことを表します。元のアイテムはハンドオフ ツール呼び出しに対するツールのレスポンスです。また、アイテムからソース/ターゲットのエージェントにもアクセスできます
- [`RunToolCallItem`](/openai-agents-js/openai/agents/classes/runtoolcallitem) は LLM がツールを呼び出したことを表します
- [`RunToolCallOutputItem`](/openai-agents-js/openai/agents/classes/runtoolcalloutputitem) はツールが呼び出されたことを表します。元のアイテムはツールのレスポンスです。アイテムからツール出力にもアクセスできます
- [`RunReasoningItem`](/openai-agents-js/openai/agents/classes/runreasoningitem) は LLM からの推論アイテムを表します。元のアイテムは生成された推論です
- [`RunToolApprovalItem`](/openai-agents-js/openai/agents/classes/runtoolapprovalitem) は LLM がツール呼び出しの承認を要求したことを表します。元のアイテムは LLM からのツール呼び出しアイテムです

## 状態

`state` プロパティには実行の状態が含まれます。`result` にぶら下がっている情報の多くは `state` から派生していますが、`state` はシリアライズ/デシリアライズ可能で、エラーからの [復旧](/openai-agents-js/ja/guides/running-agents#exceptions) が必要な場合や [`interruption`](#interruptions) に対処する場合に、後続の `run` 呼び出しの入力としても使用できます

## 割り込み

エージェントで `needsApproval` を使用している場合、`run` は継続前に対応が必要な `interruptions` を発生させることがあります。その場合、`interruptions` は割り込みの原因となった `ToolApprovalItem` の配列になります。割り込みの扱い方の詳細は、[人間の介入（HITL）](/openai-agents-js/ja/guides/human-in-the-loop) を参照してください

## その他の情報

### 元のレスポンス

`rawResponses` プロパティには、エージェント実行中にモデルが生成した LLM の元のレスポンスが含まれます

### 最後のレスポンス ID

`lastResponseId` プロパティには、エージェント実行中にモデルが生成した最後のレスポンスの ID が含まれます

### ガードレールの結果

`inputGuardrailResults` と `outputGuardrailResults` プロパティには、存在する場合にガードレールの結果が含まれます。ガードレールの結果には、ログ記録や保存に役立つ情報が含まれることがあるため、これらを利用できるようにしています

### 元の入力

`input` プロパティには、run メソッドに渡した元の入力が含まれます。ほとんどの場合は不要ですが、必要なときのために利用できます
