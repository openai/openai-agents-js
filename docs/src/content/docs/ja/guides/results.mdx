---
title: エージェントの実行結果
description: Learn how to access the results and output from your agent run
---

import { Code } from '@astrojs/starlight/components';
import handoffFinalOutputTypes from '../../../../../../examples/docs/results/handoffFinalOutputTypes.ts?raw';
import historyLoop from '../../../../../../examples/docs/results/historyLoop.ts?raw';

[エージェントの実行](/openai-agents-js/ja/guides/running-agents) を行うと、次のいずれかが返されます:

- [`RunResult`](/openai-agents-js/openai/agents/classes/runresult) は、`stream: true` なしで `run` を呼び出した場合
- [`StreamedRunResult`](/openai-agents-js/openai/agents/classes/streamedrunresult) は、`stream: true` ありで `run` を呼び出した場合。ストリーミングの詳細は [ストリーミング](/openai-agents-js/ja/guides/streaming) も参照してください

## 最終出力

プロパティ `finalOutput` には、最後に実行されたエージェントの最終出力が含まれます。この結果は次のいずれかです:

- `string` — `outputType` が定義されていないエージェントの既定値
- `unknown` — エージェントの出力タイプとして JSON スキーマが定義されている場合。この場合 JSON はパースされていますが、型の検証は手動で行う必要があります
- `z.infer<outputType>` — エージェントの出力タイプとして Zod スキーマが定義されている場合。出力はこのスキーマに対して自動的にパースされます
- `undefined` — エージェントが出力を生成しなかった場合（たとえば、出力を生成する前に停止した場合）

異なる出力タイプのハンドオフを使用している場合は、エージェントの作成に `new Agent()` コンストラクタではなく `Agent.create()` メソッドを使用してください。

これにより SDK が、起こりうるすべてのハンドオフをまたいで出力タイプを推論し、`finalOutput` プロパティに対してユニオン型を提供できるようになります。

例:

<Code
  lang="typescript"
  code={handoffFinalOutputTypes}
  title="ハンドオフの最終出力型"
/>

## 次のターンの入力

次のターンの入力にアクセスする方法は 2 つあります:

- `result.history` — 入力とエージェントの出力の両方のコピーを含みます
- `result.output` — エージェント全体の実行出力を含みます

`history` は、チャットのようなユースケースで完全な履歴を維持するための便利な手段です:

<Code lang="typescript" code={historyLoop} title="履歴ループ" />

## 最後のエージェント

プロパティ `lastAgent` には、最後に実行されたエージェントが含まれます。アプリケーションによっては、次回 ユーザー が何かを入力する際に役立つことがよくあります。たとえば、一次トリアージ用のエージェントが言語別のエージェントへハンドオフする構成の場合、最後のエージェントを保存しておき、次回 ユーザー がメッセージを送るときに再利用できます。

ストリーミング モードでは、現在実行中のエージェントに対応する `currentAgent` プロパティへアクセスするのも有用です。

## 新規アイテム

プロパティ `newItems` には、実行中に生成された新しいアイテムが含まれます。アイテムは [`RunItem`](/openai-agents-js/openai/agents/type-aliases/runitem) です。ランアイテムは、LLM が生成した 元 のアイテムをラップします。これらを使うと、LLM の出力に加えて、これらのイベントがどのエージェントに関連付けられていたかにもアクセスできます。

- [`RunMessageOutputItem`](/openai-agents-js/openai/agents/classes/runmessageoutputitem) は、LLM からのメッセージを示します。元のアイテムは生成されたメッセージです
- [`RunHandoffCallItem`](/openai-agents-js/openai/agents/classes/runhandoffcallitem) は、LLM がハンドオフ ツールを呼び出したことを示します。元のアイテムは LLM からのツール呼び出し項目です
- [`RunHandoffOutputItem`](/openai-agents-js/openai/agents/classes/runhandoffoutputitem) は、ハンドオフが発生したことを示します。元のアイテムはハンドオフ ツール呼び出しに対するツールの応答です。アイテムから送信元/宛先のエージェントにもアクセスできます
- [`RunToolCallItem`](/openai-agents-js/openai/agents/classes/runtoolcallitem) は、LLM がツールを起動したことを示します
- [`RunToolCallOutputItem`](/openai-agents-js/openai/agents/classes/runtoolcalloutputitem) は、ツールが呼び出されたことを示します。元のアイテムはツールの応答です。アイテムからツールの出力にもアクセスできます
- [`RunReasoningItem`](/openai-agents-js/openai/agents/classes/runreasoningitem) は、LLM の推論項目を示します。元のアイテムは生成された推論です
- [`RunToolApprovalItem`](/openai-agents-js/openai/agents/classes/runtoolapprovalitem) は、LLM がツール呼び出しの承認を要求したことを示します。元のアイテムは LLM からのツール呼び出し項目です

## 状態

プロパティ `state` には、実行の状態が含まれます。`result` に付随する多くは `state` から導出されていますが、`state` はシリアライズ/デシリアライズ可能で、[エラーから復旧する](/openai-agents-js/ja/guides/running-agents#exceptions) 必要がある場合や、[`interruption`](#interruptions) に対処する場合に、後続の `run` 呼び出しの入力としても使用できます。

## 割り込み

エージェントで `needsApproval` を使用している場合、続行前に処理が必要な `interruptions` が `run` をトリガーすることがあります。その場合、`interruptions` は割り込みの原因となった `ToolApprovalItem` の配列になります。割り込みの扱い方については、[人間の介入（HITL）](/openai-agents-js/ja/guides/human-in-the-loop) を参照してください。

## その他の情報

### 元のレスポンス

プロパティ `rawResponses` には、エージェントの実行中にモデルが生成した LLM の 元 のレスポンスが含まれます。

### 最後のレスポンス ID

プロパティ `lastResponseId` には、エージェントの実行中にモデルが生成した最後のレスポンスの ID が含まれます。

### ガードレールの実行結果

プロパティ `inputGuardrailResults` と `outputGuardrailResults` には、該当する場合はガードレールの結果が含まれます。ガードレールの結果には、記録や保存したい有用な情報が含まれることがあるため、これらを利用できるようにしています。

### 元の入力

プロパティ `input` には、`run` メソッドに渡した元の入力が含まれます。ほとんどの場合これは不要ですが、必要に応じて参照できます。
