---
title: ガードレール
description: Validate or transform agent input and output
---

import { Code } from '@astrojs/starlight/components';
import inputGuardrailExample from '../../../../../../examples/docs/guardrails/guardrails-input.ts?raw';
import outputGuardrailExample from '../../../../../../examples/docs/guardrails/guardrails-output.ts?raw';

ガードレールはエージェントと _並行_ して実行され、ユーザー入力やエージェント出力に対するチェックやバリデーションを行えます。例えば、高価なモデルを呼び出す前に、軽量なモデルをガードレールとして実行できます。ガードレールが悪意ある利用を検知した場合は、エラーを発生させて高コストなモデルの実行を停止できます。

ガードレールには 2 つの種類があります:

1. 入力ガードレールは最初のユーザー入力に対して実行されます
2. 出力ガードレールは最終的なエージェント出力に対して実行されます

## 入力ガードレール

入力ガードレールは 3 段階で実行されます:

1. ガードレールは、エージェントに渡されたものと同じ入力を受け取ります
2. ガードレール関数が実行され、[GuardrailFunctionOutput](/openai-agents-js/openai/agents/interfaces/guardrailfunctionoutput) を [InputGuardrailResult](/openai-agents-js/openai/agents/interfaces/inputguardrailresult) でラップして返します
3. `tripwireTriggered` が `true` の場合は、[`InputGuardrailTripwireTriggered`](/openai-agents-js/openai/agents/classes/inputguardrailtripwiretriggered) エラーがスローされます

> **注記**
> 入力ガードレールはユーザー入力を対象としているため、ワークフローでエージェントが _先頭_ の場合にのみ実行されます。エージェントごとに必要なガードレールが異なることが多いため、ガードレールはエージェント自体に設定します。

## 出力ガードレール

出力ガードレールも同様の流れです:

1. ガードレールは、エージェントに渡されたものと同じ入力を受け取ります
2. ガードレール関数が実行され、[GuardrailFunctionOutput](/openai-agents-js/openai/agents/interfaces/guardrailfunctionoutput) を [OutputGuardrailResult](/openai-agents-js/openai/agents/interfaces/outputguardrailresult) でラップして返します
3. `tripwireTriggered` が `true` の場合は、[`OutputGuardrailTripwireTriggered`](/openai-agents-js/openai/agents/classes/outputguardrailtripwiretriggered) エラーがスローされます

> **注記**
> 出力ガードレールは、ワークフローでエージェントが _最後_ の場合にのみ実行されます。リアルタイム音声での対話については [音声エージェントの構築](/openai-agents-js/ja/guides/voice-agents/build#guardrails) を参照してください。

## トリップワイヤー

ガードレールが失敗すると、トリップワイヤーでその事象を通知します。トリップワイヤーが作動した時点で、ランナーは対応するエラーをスローして実行を停止します。

## ガードレールの実装

ガードレールは、`GuardrailFunctionOutput` を返す関数にすぎません。以下は、内部で別のエージェントを実行して、ユーザーが数学の宿題の手助けを求めているかどうかを判定する最小の例です。

<Code
  lang="typescript"
  code={inputGuardrailExample}
  title="入力ガードレールの例"
/>

出力ガードレールも同じ要領です。

<Code
  lang="typescript"
  code={outputGuardrailExample}
  title="出力ガードレールの例"
/>

1. `guardrailAgent` はガードレール関数の内部で使用されます
2. ガードレール関数はエージェントの入力または出力を受け取り、結果を返します
3. ガードレール結果に追加情報を含めることができます
4. `agent` は、ガードレールが適用される実際のワークフローを定義します
