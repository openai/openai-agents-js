---
title: Realtime Agent を Twilio に接続
description: Connect your Agents SDK agents to Twilio to use voice agents
---

import { Aside, Steps, Code } from '@astrojs/starlight/components';
import twilioBasicExample from '../../../../../../examples/docs/extensions/twilio-basic.ts?raw';
import twilioServerExample from '../../../../../../examples/realtime-twilio/index.ts?raw';

Twilio は、電話の通話からの raw 音声を WebSocket サーバーへ送信する [Media Streams API](https://www.twilio.com/docs/voice/media-streams) を提供しています。このセットアップを使うと、あなたの [音声エージェントの概要](/openai-agents-js/ja/guides/voice-agents) を Twilio に接続できます。`websocket` モードで既定の Realtime Session のトランスポートを使い、Twilio から届くイベントをあなたの Realtime Session に接続することもできます。ただし、その場合は適切な音声フォーマットを設定し、Web ベースの会話よりも通話のほうが自然とレイテンシーが大きくなるため、独自の割り込みタイミングを調整する必要があります。

セットアップ体験を向上させるために、Twilio への接続を代わりに処理する専用のトランスポートレイヤーを作成しました。割り込みの処理や音声の転送も含めて処理します。

<Aside type="caution">
  このアダプターはまだベータ版です。まれなケースで問題やバグに遭遇する可能性があります。
  問題があれば [GitHub
  issues](https://github.com/openai/openai-agents-js/issues)
  に報告してください。迅速に修正します。
</Aside>

## セットアップ

<Steps>

1. **Twilio アカウントと Twilio 電話番号を用意してください。**

2. **Twilio からのイベントを受け取れる WebSocket サーバーをセットアップしてください。**

   ローカルで開発している場合、これは [`ngrok`](https://ngrok.io/) や
   [Cloudflare Tunnel](https://developers.cloudflare.com/pages/how-to/preview-with-cloudflare-tunnel/)
   のようなローカルトンネルを設定する必要があることを意味します this will require you to configure a local tunnel like
   [`ngrok`](https://ngrok.io/) または
   [Cloudflare Tunnel](https://developers.cloudflare.com/pages/how-to/preview-with-cloudflare-tunnel/)
   を使用して、ローカルのサーバーを Twilio からアクセス可能にする必要があります。`TwilioRealtimeTransportLayer`
   を使って Twilio に接続できます。

3. **拡張パッケージをインストールして Twilio アダプターを導入します:**

   ```bash
   npm install @openai/agents-extensions
   ```

4. **アダプターとモデルをインポートして `RealtimeSession` に接続します:**

   <Code
     lang="typescript"
     code={twilioBasicExample.replace(
       /\n\s+\/\/ @ts-expect-error - this is not defined/g,
       '',
     )}
   />

5. **`RealtimeSession` を Twilio に接続します:**

   ```typescript
   session.connect({ apiKey: 'your-openai-api-key' });
   ```

</Steps>

`RealtimeSession` に期待されるすべてのイベントや動作は、ツール呼び出しやガードレールなどを含め、期待どおりに動作します。`RealtimeSession` を音声エージェントとあわせて使う方法の詳細は、[音声エージェントの概要](/openai-agents-js/ja/guides/voice-agents) を参照してください。

## ヒントと留意事項

1. **スピードが命です。**

   Twilio から必要なすべてのイベントと音声を受け取るため、WebSocket 接続への参照を取得したらすぐに
   `TwilioRealtimeTransportLayer` インスタンスを作成し、その直後に `session.connect()` を呼び出してください。

2. **raw な Twilio イベントにアクセス。**

   Twilio が送信する raw イベントにアクセスしたい場合は、`RealtimeSession` インスタンス上の
   `transport_event` イベントをリッスンできます。Twilio からのすべてのイベントは `twilio_message` という type と、
   raw なイベントデータを含む `message` プロパティを持ちます。

3. **デバッグログを確認。**

   何が起きているかについて、より多くの情報が必要になる場合があります。環境変数 `DEBUG=openai-agents*` を使用すると、
   Agents SDK からのすべてのデバッグログが表示されます。あるいは `DEBUG=openai-agents:extensions:twilio*`
   を使って、Twilio アダプターのデバッグログだけを有効化できます。

## 完全なサーバーの例

以下は、Twilio からのリクエストを受け取り、`RealtimeSession` に転送する WebSocket サーバーの、エンドツーエンドの完全な例です。

<Code
  lang="typescript"
  code={twilioServerExample}
  title="Fastify を使用したサーバーの例"
/>
