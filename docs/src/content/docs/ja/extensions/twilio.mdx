---
title: Realtime Agent を Twilio に接続
description: Connect your Agents SDK agents to Twilio to use voice agents
---

import { Aside, Steps, Code } from '@astrojs/starlight/components';
import twilioBasicExample from '../../../../../../examples/docs/extensions/twilio-basic.ts?raw';
import twilioServerExample from '../../../../../../examples/realtime-twilio/index.ts?raw';

Twilio は [Media Streams API](https://www.twilio.com/docs/voice/media-streams) を提供しており、電話の通話からの元の音声を WebSocket サーバーに送信します。このセットアップは、あなたの [音声エージェントの概要](/openai-agents-js/ja/guides/voice-agents) を Twilio に接続するために使えます。`websocket` モードでデフォルトの Realtime Session のトランスポートを使用して、Twilio から届くイベントを Realtime Session に接続できます。ただし、電話通話は Web ベースの会話よりもレイテンシが大きくなりがちなため、適切な音声フォーマットの設定や、割り込みタイミングの調整を自前で行う必要があります。

セットアップ体験を向上させるために、Twilio への接続を代行する専用のトランスポート層を用意しました。割り込みの処理や音声の転送も含めて対応します。

<Aside type="caution">
  このアダプターはまだベータ版です。レアケースの問題やバグに遭遇する可能性があります。
  問題があれば [GitHub
  issues](https://github.com/openai/openai-agents-js/issues)
  から報告してください。すぐに修正します。
</Aside>

## セットアップ

<Steps>

1. **Twilio アカウントと Twilio の電話番号を用意していることを確認してください。**

2. **Twilio からのイベントを受信できる WebSocket サーバーをセットアップします。**

   ローカルで開発している場合、これは、のようなローカルトンネルを設定する必要があります
   これは、のようなローカルトンネルを設定する必要があります [`ngrok`](https://ngrok.io/) や
   [Cloudflare Tunnel](https://developers.cloudflare.com/pages/how-to/preview-with-cloudflare-tunnel/)
   を使用して、ローカル サーバーを Twilio からアクセス可能にするためです。Twilio に接続するには `TwilioRealtimeTransportLayer`
   を使えます。

3. **extensions パッケージをインストールして Twilio アダプターを導入します:**

   ```bash
   npm install @openai/agents-extensions
   ```

4. **アダプターとモデルをインポートして、`RealtimeSession` に接続します:**

   <Code
     lang="typescript"
     code={twilioBasicExample.replace(
       /\n\s+\/\/ @ts-expect-error - this is not defined/g,
       '',
     )}
   />

5. **あなたの `RealtimeSession` を Twilio に接続します:**

   ```typescript
   session.connect({ apiKey: 'your-openai-api-key' });
   ```

</Steps>

`RealtimeSession` で期待されるあらゆるイベントや動作は、ツール呼び出しやガードレールなどを含め、期待どおりに動作します。音声エージェントで `RealtimeSession` を使用する方法の詳細は、[音声エージェントの概要](/openai-agents-js/ja/guides/voice-agents)
を参照してください。

## ヒントと考慮事項

1. **スピードが命です。**

   Twilio から必要なイベントと音声をすべて受け取るには、WebSocket 接続への参照を得たらすぐに
   `TwilioRealtimeTransportLayer` インスタンスを作成し、その直後に `session.connect()` を実行してください。

2. **Twilio の元のイベントにアクセスします。**

   Twilio から送信される元のイベントにアクセスしたい場合は、`RealtimeSession` インスタンスで
   `transport_event` イベントをリッスンできます。Twilio からの各イベントは、タイプが `twilio_message` で、元のイベントデータを含む
   `message` プロパティを持ちます。

3. **デバッグログを確認します。**

   状況をより詳しく知りたい問題に遭遇することがあります。`DEBUG=openai-agents*` 環境変数を使うと、Agents SDK のすべてのデバッグログが表示されます。
   代わりに、`DEBUG=openai-agents:extensions:twilio*` を使って Twilio アダプターのデバッグログだけを有効にすることもできます。

## 完全なサンプルサーバー

以下は、Twilio からのリクエストを受け取り、それを `RealtimeSession` に転送するエンドツーエンドの WebSocket サーバーの完全な例です。

<Code
  lang="typescript"
  code={twilioServerExample}
  title="Fastify を使ったサンプルサーバー"
/>
