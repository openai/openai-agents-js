---
title: 工具
description: Provide your agents with capabilities via hosted tools or custom function tools
---

import { Code } from '@astrojs/starlight/components';
import toolsFunctionExample from '../../../../../../examples/docs/tools/functionTools.ts?raw';
import toolsHostedToolsExample from '../../../../../../examples/docs/tools/hostedTools.ts?raw';
import localBuiltInToolsExample from '../../../../../../examples/docs/tools/localBuiltInTools.ts?raw';
import nonStrictSchemaTools from '../../../../../../examples/docs/tools/nonStrictSchemaTools.ts?raw';
import agentsAsToolsExample from '../../../../../../examples/docs/tools/agentsAsTools.ts?raw';
import agentsAsToolsStreamingExample from '../../../../../../examples/docs/tools/agentsAsToolsStreaming.ts?raw';
import mcpLocalServer from '../../../../../../examples/docs/tools/mcpLocalServer.ts?raw';

工具让一个智能体能够**采取行动**——获取数据、调用外部 API、执行代码，甚至使用计算机。JavaScript/TypeScript SDK 支持五类工具：

1. **OpenAI 托管工具**——与模型一起在 OpenAI 服务器上运行。_(Web 搜索、文件搜索、code interpreter、图像生成)_
2. **本地内置工具**——在你的环境中运行。_(计算机操作、Shell、apply_patch)_
3. **函数工具**——用 JSON schema 包装任意本地函数，使 LLM 能调用。
4. **将智能体作为工具**——将整个智能体暴露为可调用的工具。
5. **MCP 服务器**——附加一个 Model Context Protocol 服务器（本地或远程）。

---

## 1. 托管工具（OpenAI Responses API）

当你使用 `OpenAIResponsesModel` 时，可以添加以下内置工具：

| 工具                    | 类型字符串           | 目的                             |
| ----------------------- | -------------------- | -------------------------------- |
| Web search              | `'web_search'`       | 互联网搜索。                     |
| File / retrieval search | `'file_search'`      | 查询托管在 OpenAI 上的向量存储。 |
| Code Interpreter        | `'code_interpreter'` | 在沙盒环境中运行代码。           |
| Image generation        | `'image_generation'` | 基于文本生成图像。               |

<Code lang="typescript" code={toolsHostedToolsExample} title="托管工具" />

精确的参数集合与 OpenAI Responses API 一致——有关 `rankingOptions` 或语义过滤等高级选项，请参阅官方文档。

---

## 2. 本地内置工具

本地内置工具在你的环境中运行，需要你提供实现：

- **计算机操作**——实现 `Computer` 接口并传给 `computerTool()`。
- **Shell**——实现 `Shell` 接口并传给 `shellTool()`。
- **应用补丁**——实现 `Editor` 接口并传给 `applyPatchTool()`。

这些工具在本地执行，**不**由 OpenAI 托管。当你需要在运行时直接访问文件、终端或 GUI 自动化时使用它们。工具调用仍由 OpenAI 模型的响应发起，但你的应用需要在本地执行它们。

<Code lang="typescript" code={localBuiltInToolsExample} title="本地内置工具" />

---

## 3. 函数工具

你可以使用 `tool()` 辅助函数将**任意**函数转换为工具。

<Code
  lang="typescript"
  code={toolsFunctionExample}
  title="使用 Zod 参数的函数工具"
/>

### 选项参考

| 字段               | 必填 | 描述                                                                                                                                  |
| ------------------ | ---- | ------------------------------------------------------------------------------------------------------------------------------------- |
| `name`             | 否   | 默认为函数名（例如 `get_weather`）。                                                                                                  |
| `description`      | 是   | 向 LLM 显示的清晰、可读的人类描述。                                                                                                   |
| `parameters`       | 是   | Zod schema 或原始 JSON schema 对象。使用 Zod 参数会自动启用**严格**模式。                                                             |
| `strict`           | 否   | 当为 `true`（默认）时，如果参数校验失败，SDK 会返回模型错误。设为 `false` 可进行模糊匹配。                                            |
| `execute`          | 是   | `(args, context) => string \| unknown \| Promise<...>`——你的业务逻辑。非字符串输出会被序列化供模型使用。可选第二参数为 `RunContext`。 |
| `errorFunction`    | 否   | 自定义处理器 `(context, error) => string`，将内部错误转换为对用户可见的字符串。                                                       |
| `needsApproval`    | 否   | 在执行前需要人工批准。参见[人机协作](/openai-agents-js/zh/guides/human-in-the-loop)。                                                 |
| `isEnabled`        | 否   | 按运行条件性地暴露工具；接受布尔值或谓词。                                                                                            |
| `inputGuardrails`  | 否   | 在工具执行前运行的护栏；可拒绝或抛出。参见[护栏](/openai-agents-js/zh/guides/guardrails#tool-guardrails)。                            |
| `outputGuardrails` | 否   | 在工具执行后运行的护栏；可拒绝或抛出。参见[护栏](/openai-agents-js/zh/guides/guardrails#tool-guardrails)。                            |

### 非严格 JSON schema 工具

如果你需要模型在输入无效或不完整时进行“猜测”，可在使用原始 JSON schema 时禁用严格模式：

<Code
  lang="typescript"
  code={nonStrictSchemaTools}
  title="非严格 JSON schema 工具"
/>

---

## 4. 将智能体作为工具

有时你希望一个智能体在不完全交接对话的情况下“辅助”另一个智能体。使用 `agent.asTool()`：

<Code lang="typescript" code={agentsAsToolsExample} title="将智能体作为工具" />

在底层，SDK 会：

- 创建一个只有单个 `input` 参数的函数工具。
- 当工具被调用时，使用该输入运行子智能体。
- 返回最后一条消息或由 `customOutputExtractor` 提取的输出。

当你将智能体作为工具运行时，Agents SDK 会使用默认设置创建一个 runner，并在函数执行中用它来运行该智能体。若要提供任何 `runConfig` 或 `runOptions` 的属性，可以将它们传给 `asTool()` 来自定义 runner 的行为。

你也可以通过 `asTool()` 选项在智能体工具上设置 `needsApproval` 和 `isEnabled`，以集成到人机协作流程和条件性工具可用性中。

### 来自智能体工具的流式事件

智能体工具可以将所有嵌套运行事件流式传回你的应用。选择与你构建工具方式相匹配的钩子风格：

<Code
  lang="typescript"
  code={agentsAsToolsStreamingExample}
  title="流式传输智能体工具"
/>

- 事件类型与 `RunStreamEvent['type']` 一致：`raw_model_stream_event`、`run_item_stream_event`、`agent_updated_stream_event`。
- `onStream` 是最简单的“全捕获”方式，适合在内联声明工具时使用（`tools: [agent.asTool({ onStream })]`）。如果不需要按事件路由，请使用它。
- `on(eventName, handler)` 允许选择性订阅（或使用 `'*'`），当你需要更细粒度的处理或希望在创建后附加监听器时最佳。
- 如果提供了 `onStream` 或任意 `on(...)` 处理器，作为工具的智能体将自动以流式模式运行；否则保持非流式路径。
- 处理器并行调用，因此缓慢的 `onStream` 回调不会阻塞 `on(...)` 处理器（反之亦然）。
- 当工具通过模型工具调用触发时会提供 `toolCallId`；直接 `invoke()` 调用或提供商差异可能省略它。

---

## 5. MCP 服务器

你可以通过 [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) 服务器暴露工具，并将它们附加到智能体。
例如，你可以使用 `MCPServerStdio` 启动并连接到 stdio MCP 服务器：

<Code lang="typescript" code={mcpLocalServer} title="本地 MCP 服务器" />

完整示例参见[`filesystem-example.ts`](https://github.com/openai/openai-agents-js/tree/main/examples/mcp/filesystem-example.ts)。另外，如果你在寻找关于 MCP 服务器工具集成的完整指南，请参考[MCP 集成](/openai-agents-js/zh/guides/mcp)获取详情。

---

## 工具使用行为

关于控制模型何时以及如何必须使用工具（`tool_choice`、`toolUseBehavior` 等），请参阅[智能体](/openai-agents-js/zh/guides/agents#forcing-tool-use)。

---

## 最佳实践

- **简短且明确的描述**——描述工具做了什么，以及何时使用它。
- **验证输入**——尽可能使用 Zod schema 进行严格的 JSON 校验。
- **避免在错误处理器中产生副作用**——`errorFunction` 应返回有帮助的字符串，而不是抛出异常。
- **每个工具只做一件事**——小而可组合的工具有助于更好的模型推理。

---

## 后续步骤

- 了解[强制使用工具](/openai-agents-js/zh/guides/agents#forcing-tool-use)。
- 添加[护栏](/openai-agents-js/zh/guides/guardrails)以验证工具的输入或输出。
- 查阅 TypeDoc 参考文档，了解[`tool()`](/openai-agents-js/openai/agents/functions/tool) 以及各种托管工具类型。
