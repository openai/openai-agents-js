---
title: 护栏
description: Validate or transform agent input and output
---

import { Code } from '@astrojs/starlight/components';
import inputGuardrailExample from '../../../../../../examples/docs/guardrails/guardrails-input.ts?raw';
import outputGuardrailExample from '../../../../../../examples/docs/guardrails/guardrails-output.ts?raw';

护栏与您的智能体*并行*运行，允许您对用户输入或智能体输出执行检查和验证。例如，您可以在调用昂贵的模型之前，先运行一个轻量模型作为护栏。如果护栏检测到恶意用法，它可以触发错误并阻止高成本模型运行。

护栏分为两类：

1. **输入护栏**在初始用户输入上运行。
2. **输出护栏**在最终智能体输出上运行。

## 输入护栏

输入护栏分三步运行：

1. 护栏接收传递给智能体的相同输入。
2. 护栏函数执行并返回一个[`GuardrailFunctionOutput`](/openai-agents-js/openai/agents/interfaces/guardrailfunctionoutput)，该结果被包装在[`InputGuardrailResult`](/openai-agents-js/openai/agents/interfaces/inputguardrailresult)中。
3. 如果`tripwireTriggered`为`true`，将抛出[`InputGuardrailTripwireTriggered`](/openai-agents-js/openai/agents/classes/inputguardrailtripwiretriggered)错误。

> **注意**
> 输入护栏用于用户输入，因此仅当该智能体是工作流中的*第一个*智能体时才会运行。护栏在智能体本身上配置，因为不同智能体通常需要不同的护栏。

## 输出护栏

输出护栏分三步运行：

1. 护栏接收由智能体生成的输出。
2. 护栏函数执行并返回一个[`GuardrailFunctionOutput`](/openai-agents-js/openai/agents/interfaces/guardrailfunctionoutput)，该结果被包装在[`OutputGuardrailResult`](/openai-agents-js/openai/agents/interfaces/outputguardrailresult)中。
3. 如果`tripwireTriggered`为`true`，将抛出[`OutputGuardrailTripwireTriggered`](/openai-agents-js/openai/agents/classes/outputguardrailtripwiretriggered)错误。

> **注意**
> 仅当该智能体是工作流中的*最后一个*智能体时，输出护栏才会运行。对于实时语音交互，请参阅[构建语音智能体](/openai-agents-js/zh/guides/voice-agents/build#guardrails)。

## 绊线

当护栏失败时，会通过绊线发出信号。一旦触发绊线，运行器将抛出相应错误并停止执行。

## 护栏实现

护栏本质上是一个返回`GuardrailFunctionOutput`的函数。下面是一个最小示例，通过在内部运行另一个智能体来检查用户是否在寻求数学作业帮助。

<Code lang="typescript" code={inputGuardrailExample} title="输入护栏示例" />

输出护栏以相同方式工作。

<Code lang="typescript" code={outputGuardrailExample} title="输出护栏示例" />

1. `guardrailAgent`在护栏函数内部使用。
2. 护栏函数接收智能体的输入或输出并返回结果。
3. 可以在护栏结果中包含额外信息。
4. `agent`定义应用护栏的实际工作流。
