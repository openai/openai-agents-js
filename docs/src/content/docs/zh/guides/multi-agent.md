---
title: 多智能体编排
description: Coordinate the flow between several agents
---

在应用中，编排指的是智能体的流转：哪些智能体运行、以什么顺序运行、以及它们如何决定下一步。编排智能体主要有两种方式：

1. 让 LLM 做决策：利用 LLM 的智能进行规划、推理，并据此决定要采取的步骤。
2. 通过代码进行编排：用代码决定智能体的流程。

你可以混合搭配这些模式。每种方式都有取舍，详见下文。

## 基于 LLM 的编排

智能体是配备了 instructions、tools 和交接 的 LLM。这意味着面对开放式任务，LLM 可以自主规划解决方案，使用 tools 采取行动和获取数据，并通过交接将子任务委派给子智能体。比如，一个研究型智能体可以配备如下工具：

- Web 搜索，用于在线查找信息
- 文件搜索与检索，用于在私有数据和连接中搜索
- 计算机操作，用于在计算机上执行操作
- 代码执行，用于进行数据分析
- 交接至擅长规划、撰写报告等的专门智能体

当任务是开放式且你希望依赖 LLM 的智能时，这种模式非常合适。关键策略包括：

1. 投入到高质量的提示词中。明确可用的工具、如何使用，以及必须遵循的参数范围。
2. 监控并迭代你的应用。定位问题所在，并迭代优化提示词。
3. 允许智能体自省和改进。例如，让它在循环中运行并自我批判；或提供错误信息并让它改进。
4. 让专门智能体在单一任务上做到最好，而不是期望通用型智能体能在所有方面表现出色。
5. 投入到[evals](https://platform.openai.com/docs/guides/evals)。这有助于训练智能体在任务上不断提升。

## 基于代码的编排

尽管基于 LLM 的编排很强大，但基于代码的编排能在速度、成本和性能方面更具确定性和可预测性。常见模式包括：

- 使用[structured outputs](https://platform.openai.com/docs/guides/structured-outputs)生成可由代码检查的格式良好的数据。例如，你可以让智能体将任务分类为几个类别，然后根据该类别选择下一个智能体。
- 将多个智能体串联，把上一个的输出转换为下一个的输入。你可以把写博客这样的任务拆解为一系列步骤——做研究、写提纲、撰写正文、批判性审阅、再改进。
- 在一个执行任务的智能体外，再配一个评估并反馈的智能体，用 `while` 循环运行，直到评估者认为输出满足特定标准。
- 并行运行多个智能体，例如通过 JavaScript 的 `Promise.all` 等基础组件。当有多个彼此独立的任务时，这能提升速度。

我们在[`examples/agent-patterns`](https://github.com/openai/openai-agents-js/tree/main/examples/agent-patterns)中提供了若干示例。
