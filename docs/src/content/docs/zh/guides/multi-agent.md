---
title: 多智能体编排
description: Coordinate the flow between several agents
---

编排指的是应用中智能体的执行流程：哪些智能体运行、以什么顺序运行、以及它们如何决定下一步。编排智能体主要有两种方式：

1. 允许 LLM 做决策：利用 LLM 的智能来规划、推理，并据此决定下一步操作。
2. 通过代码进行编排：用代码决定智能体的流转。

这两种模式可以混合使用。各有取舍，详见下文。

## 通过 LLM 的编排

智能体是配备了指令、工具和交接的 LLM。这意味着面对开放式任务时，LLM 可以自主规划解决步骤，使用工具执行动作和获取数据，并通过交接把子任务委派给子智能体。例如，一个研究型智能体可以配备如下工具：

- Web 搜索，用于在线查找信息
- 文件搜索与检索，用于检索专有数据与连接
- 计算机操作，用于在计算机上执行动作
- 代码执行，用于进行数据分析
- 交接，委派给擅长规划、写报告等的专业智能体

当任务是开放式且希望依赖 LLM 的智能时，这种模式效果很好。关键做法包括：

1. 打磨高质量提示。明确可用的工具、用法，以及必须遵循的参数范围。
2. 监控并迭代应用。找出问题点，并迭代优化提示。
3. 允许智能体自省与改进。例如循环运行并让其自我批判；或提供错误信息并让其改进。
4. 使用在单一任务上表现出色的专业智能体，而非期望一个通用智能体样样精通。
5. 投入于[评测](https://platform.openai.com/docs/guides/evals)。这有助于训练智能体、持续提升任务表现。

## 通过代码的编排

虽然通过 LLM 编排很强大，但通过代码编排能在速度、成本与性能上更具确定性与可预测性。常见模式包括：

- 使用[structured outputs](https://platform.openai.com/docs/guides/structured-outputs)生成可由代码检查的格式良好的数据。例如，让智能体将任务分类到若干类别，然后基于类别选择下一个智能体。
- 级联多个智能体，将上一个的输出转化为下一个的输入。可将写博客一类的任务分解为一系列步骤——做研究、写大纲、写正文、批判性审阅、再改进。
- 使用一个执行任务的智能体与一个评估并反馈的智能体在 `while` 循环中运行，直到评估者判定输出符合标准。
- 并行运行多个智能体，例如通过 JavaScript 的 `Promise.all` 等基础组件。当有多个互不依赖的任务时，这有助于提升速度。

我们在[`examples/agent-patterns`](https://github.com/openai/openai-agents-js/tree/main/examples/agent-patterns)中提供了若干示例。
