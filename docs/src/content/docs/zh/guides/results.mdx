---
title: 执行结果
description: Learn how to access the results and output from your agent run
---

import { Code } from '@astrojs/starlight/components';
import handoffFinalOutputTypes from '../../../../../../examples/docs/results/handoffFinalOutputTypes.ts?raw';
import historyLoop from '../../../../../../examples/docs/results/historyLoop.ts?raw';
import usageExample from '../../../../../../examples/docs/results/usage.ts?raw';

当你[运行智能体](/openai-agents-js/zh/guides/running-agents)时，你会得到以下两种之一的结果：

- [`RunResult`](/openai-agents-js/openai/agents/classes/runresult)，当你调用 `run` 且未设置 `stream: true`
- [`StreamedRunResult`](/openai-agents-js/openai/agents/classes/streamedrunresult)，当你调用 `run` 且设置了 `stream: true`。关于流式传输的详情，请参阅[流式传输](/openai-agents-js/zh/guides/streaming)。

## 最终输出

`finalOutput` 属性包含最后一个运行的智能体的最终输出。该结果可能为：

- `string` —— 对于未定义 `outputType` 的任何智能体的默认值
- `unknown` —— 如果智能体的输出类型定义为 JSON 模式。在这种情况下 JSON 已被解析，但你仍需要手动验证其类型。
- `z.infer<outputType>` —— 如果智能体的输出类型定义为 Zod 模式。输出将自动按该模式解析。
- `undefined` —— 如果智能体未产生输出（例如在产生输出前被停止）

如果你在使用具有不同输出类型的交接，应使用 `Agent.create()` 方法而不是 `new Agent()` 构造函数来创建智能体。

这将使 SDK 能够在所有可能的交接中推断输出类型，并为 `finalOutput` 属性提供联合类型。

例如：

<Code
  lang="typescript"
  code={handoffFinalOutputTypes}
  title="交接的最终输出类型"
/>

## 下一轮的输入

你可以通过两种方式获取下一轮的输入：

- `result.history` —— 包含你的输入和智能体输出的副本。
- `result.output` —— 包含整次智能体运行的输出。

在类似聊天的用例中，使用 `history` 维护完整历史记录更方便：

<Code lang="typescript" code={historyLoop} title="历史循环" />

## 最后一个智能体

`lastAgent` 属性包含最后一个运行的智能体。根据你的应用，这通常对下一次用户输入很有用。例如，如果你有一个前线分诊智能体将会交接给特定语言的智能体，你可以存储最后一个智能体，并在下次用户向智能体发消息时复用它。

在流式模式下，访问映射到当前正在运行的智能体的 `currentAgent` 属性也很有用。

## 新增条目

`newItems` 属性包含在运行期间生成的新条目。条目为 [`RunItem`](/openai-agents-js/openai/agents/type-aliases/runitem)。运行条目包装由 LLM 生成的原始条目。除了访问 LLM 的输出外，还可用于确定这些事件关联的是哪个智能体。

- [`RunMessageOutputItem`](/openai-agents-js/openai/agents/classes/runmessageoutputitem) 表示来自 LLM 的消息。原始条目是生成的消息。
- [`RunHandoffCallItem`](/openai-agents-js/openai/agents/classes/runhandoffcallitem) 表示 LLM 调用了交接工具。原始条目是来自 LLM 的工具调用条目。
- [`RunHandoffOutputItem`](/openai-agents-js/openai/agents/classes/runhandoffoutputitem) 表示发生了交接。原始条目是对交接工具调用的工具响应。你也可以从该条目访问源/目标智能体。
- [`RunToolCallItem`](/openai-agents-js/openai/agents/classes/runtoolcallitem) 表示 LLM 调用了某个工具。
- [`RunToolCallOutputItem`](/openai-agents-js/openai/agents/classes/runtoolcalloutputitem) 表示某个工具被调用。原始条目是工具响应。你也可以从该条目访问工具输出。
- [`RunReasoningItem`](/openai-agents-js/openai/agents/classes/runreasoningitem) 表示来自 LLM 的推理条目。原始条目是生成的推理。
- [`RunToolApprovalItem`](/openai-agents-js/openai/agents/classes/runtoolapprovalitem) 表示 LLM 请求对某个工具调用进行批准。原始条目是来自 LLM 的工具调用条目。

## 状态

`state` 属性包含此次运行的状态。附加在 `result` 上的大多数信息都来源于 `state`，但 `state` 可序列化/反序列化，并且在你需要[从错误恢复](/openai-agents-js/zh/guides/running-agents#exceptions)或处理[`interruption`](#interruptions)时，也可作为后续调用 `run` 的输入。

## 中断

如果你在智能体中使用了 `needsApproval`，你的 `run` 可能会触发一些需要在继续之前处理的 `interruptions`。此时 `interruptions` 将是导致中断的 `ToolApprovalItem` 数组。有关如何处理中断的更多信息，请查看[人机协作](/openai-agents-js/zh/guides/human-in-the-loop)指南。

## 其他信息

### 原始响应

`rawResponses` 属性包含智能体运行期间由模型生成的原始 LLM 响应。

### 最后响应 ID

`lastResponseId` 属性包含智能体运行期间由模型生成的最后一个响应的 ID。

### 护栏结果

`inputGuardrailResults` 和 `outputGuardrailResults` 属性包含护栏的结果（如果有）。护栏结果有时包含你希望记录或存储的有用信息，因此我们将其提供给你。

工具护栏结果通过 `toolInputGuardrailResults` 和 `toolOutputGuardrailResults` 分别暴露。

### 用量

Token 用量汇总在 `result.state.usage` 中，其中跟踪了本次运行的请求次数和 token 总数。对于流式运行，这些数据会随着响应到达而更新。

<Code lang="typescript" code={usageExample} title="从 RunState 读取用量" />

### 原始输入

`input` 属性包含你提供给 run 方法的原始输入。大多数情况下你不需要它，但在需要时可用。
